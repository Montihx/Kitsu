# Security — политика безопасности проекта KITSU

> ⚠️ **КРИТИЧЕСКИЙ ДОКУМЕНТ**
> Этот файл определяет **обязательные требования безопасности** для всего проекта KITSU.
> Используется Backend, Frontend и **AI Copilot / Agent**.
>
> ❌ Любое отклонение считается уязвимостью
> ❌ Упрощения «для скорости» запрещены

---

## 1. Цели безопасности

Основные цели:

* защита API-ключей и секретов
* предотвращение утечек данных
* защита от типовых веб-атак
* безопасная работа с внешними провайдерами

---

## 2. Управление секретами

### 2.1 ENV-переменные

Все секреты хранятся **только** в ENV:

* API ключи провайдеров
* JWT secrets (в будущем)
* ключи Redis / DB

❌ Запрещено:

* хардкод
* коммиты секретов
* логирование значений

---

## 3. Backend Security

### 3.1 HTTP

* HTTPS only
* CORS — whitelist
* secure headers (CSP, HSTS)

---

### 3.2 Валидация входных данных

* строгие схемы (Pydantic)
* проверка типов
* ограничения длины строк

---

### 3.3 SSRF Protection

* whitelist доменов провайдеров
* запрет внутренних IP
* проверка URL перед запросом

---

### 3.4 Rate Limiting

* глобальный rate limit
* отдельный лимит для тяжёлых эндпоинтов

---

## 4. Provider Security

* таймауты обязательны
* retry с backoff
* защита от бесконечных ожиданий

---

## 5. Frontend Security

### 5.1 XSS

* экранирование HTML
* запрет dangerouslySetInnerHTML

---

### 5.2 Player

* video src только от backend
* запрет inline JS

---

## 6. Логирование

Разрешено логировать:

* error codes
* stack trace (без данных)

❌ Запрещено:

* токены
* URL с ключами
* ответы провайдеров целиком

---

## 7. Dependency Security

* регулярные обновления
* запрет deprecated библиотек
* аудит зависимостей

---

## 8. Deployment Security

* отдельные ENV для prod/stage
* минимальные права сервисов
* firewall

---

## 9. Инциденты

* логирование
* алерты
* быстрый rollback

---

## 10. Требования для AI-агента

* безопасность приоритет №1
* при сомнениях — блокировать функционал

---

## 11. Статус документа

* обязателен
* canonical
* нарушение = security bug
